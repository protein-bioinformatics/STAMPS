<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8"/>
<link rel="stylesheet" type="text/css" href="qsdb.css">
<script src="qsdb-functions.js"></script>
<script src="ms-view.js"></script>
<script src="qsdb.js"></script>
<title>QSDB Home</title>
</head>
<body>
<div class="navigation">
    <table width="100%" height=50><tr>
        <td class="navigation_cell" style="font-size: 150%; display: inline; border-width: 0px;">
            <div style="display: inline; font-weight: bold;">Q</div>uality 
            <div style="display: inline; font-weight: bold;">S</div>tandard
            <div style="display: inline; font-weight: bold;">D</div>ata<div style="display: inline; font-weight: bold;">b</div>ase
            <div width="80%" style="display: inline; min-width: 80%;">&nbsp;</div>
        </td>
    
        <td class="navigation_cell_click" align="center" style="border-left: white; border-left-style: solid; border-left-width: 1px;">Feedback</td>
        <td class="navigation_cell_click" align="center">References</td>
        <td class="navigation_cell_click" align="center" onclick="location.href = 'mailto:dominik.kopczynski@isas.de';">Contact</td>
    </tr></table>
</div>

<div style="position:fixed; width:100%; height: 100%; top: 0px;">
    <table width=100% height=100%><tr>
        <td width=50% align="center" valign="middle"><img src="database-logo.svg"></td>
        <td width=50% height=100% align="center" valign="middle">
            <div style="border-width: 3px; border-color: #999999; border-style: solid; width: 60%; height: 60%; padding-left: 20px; padding-top: 10px; text-align: left; border-radius: 25px; box-shadow: 5px 5px 10px grey; border-collapse: separate;">
                <div style="font-size: 150%;">Overview</div><p>
                <table width=80% cellpadding=5 style="font-size: 120%">
                    <tr><td width=50%>Version:</td><td align="right">v1.0.0</td></tr>
                    <tr><td>Organisms:</td><td align="right">1 (Mouse)</td></tr>
                    <tr><td>Proteins:</td><td align="right">11664 of 16802 (69.42%)</td></tr>
                    <tr><td>Proteins in pathways:</td><td align="right">1203 of 1656 (72.64%)</td></tr>
                    <tr><td>Unique Peptides:</td><td align="right">125,608</td></tr>
                    <tr><td>Spectra:</td><td align="right">165,798</td></tr>
                </table>
            </div>
        </td>
    </tr></table>
</div>

<div style="position:fixed; width:100%; height: 130px; bottom:0px;">
    <div id="navigation_startpage" class="navigation_startpage">
    <table height=130>
    <tr><td width="50%">
    </td>
    
    <td style="min-width: 200px; border-left: white; border-left-style: solid; border-left-width: 1px;" id="how_to_nav" class="navigation_cell_click" align="center">
        <img src="how-to.svg" height=80><br>
        How&nbsp;To
    </td>
    
    <td style="min-width: 200px;" class="navigation_cell_click" id="pathway_browser_nav" align="center" onclick="location.href = 'browser.html';">
        <img src="pathway-browser.svg" height=80><br>
        Pathway&nbsp;Browser
    </td>
    
    <td style="min-width: 200px;" class="navigation_cell_click" id="subcellular_search_nav" align="center" onclick="advanced_search_init(); open_locus_search();">
        <img src="cell.svg" height=80><br>
        Subcellular&nbsp;Search
    </td>
    
    <td style="min-width: 200px;" class="navigation_cell_click" id="functional_search_nav" align="center" onclick="advanced_search_init(); open_function_search();">
        <img src="gears.svg" height=80><br>
        Functional&nbsp;Search
    </td>
    
    <td style="min-width: 200px;" class="navigation_cell_click" id="accession_search_nav" align="center" onclick="advanced_search_init(); open_accession_search();">
        <img src="accession-search.svg" height=80><br>
        Accession&nbsp;Search
    </td>
    
    <td style="min-width: 200px;" id="statistics_nav" class="navigation_cell_click" align="center">
        <img src="statistics.svg" height=80><br>
        Statistics
    </td>
    
    <td style="min-width: 200px;" id="about_nav" class="navigation_cell_click" align="center" onclick="open_disclaimer();">
        <img src="about.svg" height=80><br>
        About
    </td><td width="50%"></tr>
    </table>
    </div>
</div>





<div id="disclaimer" class="disclaimer" align="justify">
<center><b>About QSDB</b></center><p>
The quality standard database (QSDB) provides a pathway based approach to access proteomics assays for targeted proteomics.
Currently, we are acquiring mass spectra for all proteins within the mouse organism.
Our mass spetrometer is a QExactive Plus or HF, capable to produce high-resolution high-mass accuracy LC-MS/MS spectra.<p>
Responsible people for this database are:<br>
Dominik Kopczynski: Implementation of both front- and backend<br>
Andreas Hentschel: Acquisition and processing of the data<br>
Robert Ahrends: Coordination<p>
The ISAS team is supported by the German network of bioinformatics services (<a href="http://www.denbi.de">de.NBI</a>).
If you have questions, suggestions or other issues, please <a href="mailto:foo@foo.de">contact</a> us.
<p>&nbsp;<p>&nbsp;<p>


<center><b>Disclaimer</b></center><p>
<b>1. Liability limitation</b><br>
Although we acquired our data with highest accurateness, we take no responsibility for the correctness, completeness or up-to-dateness of this data.
The usage of the downloadable data available on this web page takes place at the users own risk.
<p>
 
<b>2. External links</b><br>
This web page contains links forwarding to external web pages.
For all external web pages we disclaim liability.
During the linking no statutory violation was evident.
As soon as a violation emerges, we delete these links.
<p>

<b>3. Copyright</b><br>
The content of this web page is subject to the German copyright law and ancillary copyright.
Every inadmissible utilization defined by the German copyright law and ancillary copyright is forbidden.
This includes the disposal of the downloadable data. 
Download and utilization of the available data for researching purposes is explicitly allowed.
<p>
 
<b>4. Privacy</b><br>
For statistical purposes, we record the number of visits to this web page as well as the number of downloads.
To ensure an unbiased record, we store a hash value of your IP address for several minutes.
Since this method is not reversible, restoring your IP address is not possible, hence this value does not belong to personal-related data.
We do not sell or hand out our collected statistical data to third parties.
<p>
The usage, selling or handing of the contact data written in this imprint is not allowed.
<p>
</div>
<div id="disclaimer_background" class="disclaimer_background"></div>






<div id="accession_search" class="disclaimer">
    <table cellspacing=20><tr><td>
    <div id="accession_search_field" style="display: inline;">
    Paste UniProt accession numbers:<br>
        <textarea id="accessions" style="width:300px; height:500px;"></textarea>
    </div>
    </td><td width=100% height=100% style="border-width: 2px; border-style: solid; border-color: black; border-radius: 25px;">
    <b>Filter criteria:</b><p>&nbsp;<p>&nbsp;<p>
    <div id="filter_panel_accession">
    </div>
    </td></tr>
    <tr>
        <td colspan=2>
            <table width=100%><tr><td id="error_filter_text_accession" style="color: red; font-weight: bold;">
            </td><td align=right><button onclick="hide_accession_search();" style="display: inline;">Cancel</button>&nbsp;<button onclick="check_filter_valid_accessions();">Next</button>
            </td></tr></table>
        </td>
    </tr>
    </table>
</div>
<div id="accession_search_background" class="disclaimer_background"></div>


<div id="locus_search" class="disclaimer">
    <table cellspacing=20><tr><td>
    <div id="accession_search_field" style="display: inline;">
    Select subcellular compartment(s):<br>
        <select id="loci" size=20 style="width:300px; height:480px;" multiple></select>Hold <b>[ctrl]</b> for multiple selection.
    </div>
    </td><td width=100% height=100% style="border-width: 2px; border-style: solid; border-color: black; border-radius: 25px;">
    <b>Filter criteria:</b><p>&nbsp;<p>&nbsp;<p>
    <div id="filter_panel_locus">
    </div>
    </td></tr>
    <tr>
        <td colspan=2>
            <table width=100%><tr><td id="error_filter_text_locus" style="color: red; font-weight: bold;">
            </td><td align=right><button onclick="hide_locus_search();" style="display: inline;">Cancel</button>&nbsp;<button onclick="check_filter_valid_loci();">Next</button>
            </td></tr></table>
        </td>
    </tr>
    </table>
</div>
<div id="locus_search_background" class="disclaimer_background"></div>



<div id="function_search" class="disclaimer">
    <table cellspacing=20><tr><td>
    Select protein function(s):<br>
    <div id="function_search_field" style="min-width: 500px; width: 500px; min-height: 500px; height: 500px; border-width: 1px; border-color: gray; border-style: solid; overflow-y: scroll;">
    
        
    </div>
    </td><td width=100% height=100% style="border-width: 2px; border-style: solid; border-color: black; border-radius: 25px;">
    <b>Filter criteria:</b><p>&nbsp;<p>&nbsp;<p>
    <div id="filter_panel_function">
    </div>
    </td></tr>
    <tr>
        <td colspan=2>
            <table width=100%><tr><td id="error_filter_text_function" style="color: red; font-weight: bold;">
            </td><td align=right><button onclick="hide_function_search();" style="display: inline;">Cancel</button>&nbsp;<button onclick="check_filter_valid_function();">Next</button>
            </td></tr></table>
        </td>
    </tr>
    </table>
</div>
<div id="function_search_background" class="disclaimer_background"></div>




<div id="download" class="download"></div>
<div id="downloadbackground" class="downloadbackground"></div>

<div id="check_spectra" class="check_spectra">
    <canvas id="msarea" class="msarea"></canvas>
    <fieldset id="spectra_options" class="spectra_options" style="position: fixed; border: 0px; margin: 0px; top: 0px; padding: px;">
        <input type="radio" onchange="change_match_error();" id="radio_ppm" name="select_error" value="ppm" style="border: 0px; margin: 0px; top: 0px; padding: 0px;" checked><label for="radio_ppm">Relative</label>
        <input type="radio" onchange="change_match_error();" id="radio_da" name="select_error" value="Da" style="border: 0px; margin: 0px; top: 0px; padding: 0px;"><label for="radio_da">Absolute</label>
        <input type="text" onchange="change_match_error_value();" id="error_value" value="-" size=1 style="text-align: right;"><label id="unit">ppm</label>
    </fieldset>
    <div id="spectra_panel" class="spectra_panel"></div>
    <table width="100%" height="100%"><tr><td valign="bottom" align="right"><button onclick="hide_check_spectra();" style="display: inline;">Cancel</button> <button onclick="hide_check_spectra(); back_function();">Back</button> <button onclick="hide_check_spectra(); download_assay();">Go to Download</button></td></tr></table>
</div>
<div id="check_spectra_background" class="check_spectra_background"></div>

<audio style="display: none;"><source src="kns.mp3"></source>
</body>
<script>
function check_filter_valid_accessions(){
    if (document.getElementById("accessions").value.length == 0){
        document.getElementById("error_filter_text_accession").innerHTML = "Error: no accession number provided!";
    }
    else if (parseInt(document.getElementById("min_peptide_length").value) > parseInt(document.getElementById("max_peptide_length").value)){
        document.getElementById("error_filter_text_accession").innerHTML = "Error: minimal peptide length higher than maximal!";
    }
    else if (parseInt(document.getElementById("min_precursor_charge").value) > parseInt(document.getElementById("max_precursor_charge").value)) {
        document.getElementById("error_filter_text_accession").innerHTML = "Error: minimal precursor charge higher than maximal!";
    }
    else {
        adopt_filter_parameters();
        back_function = open_accession_search;
        hide_accession_search();
        accession_search_parse_accessions();
    }
}


function check_filter_valid_loci(){
    if (parseInt(document.getElementById("min_peptide_length").value) > parseInt(document.getElementById("max_peptide_length").value)){
        document.getElementById("error_filter_text_locus").innerHTML = "Error: minimal peptide length higher than maximal!";
    }
    else if (parseInt(document.getElementById("min_precursor_charge").value) > parseInt(document.getElementById("max_precursor_charge").value)) {
        document.getElementById("error_filter_text_locus").innerHTML = "Error: minimal precursor charge higher than maximal!";
    }
    else {
        adopt_filter_parameters();
        back_function = open_locus_search;
        hide_locus_search();
        locus_search_request_data();
    }
}



function check_filter_valid_function(){
    if (parseInt(document.getElementById("min_peptide_length").value) > parseInt(document.getElementById("max_peptide_length").value)){
        document.getElementById("error_filter_text_function").innerHTML = "Error: minimal peptide length higher than maximal!";
    }
    else if (parseInt(document.getElementById("min_precursor_charge").value) > parseInt(document.getElementById("max_precursor_charge").value)) {
        document.getElementById("error_filter_text_function").innerHTML = "Error: minimal precursor charge higher than maximal!";
    }
    else {
        adopt_filter_parameters();
        back_function = open_function_search;
        hide_function_search();
        function_search_request_data();
    }
}

var filter_panel_data = "<div id=\"filter_panel\" style=\"display: none;\"> \
    <table> \
        <tr><td>Min. peptide length</td><td><input type=\"number\" min=\"8\" max=\"25\" id=\"min_peptide_length\" /><td></tr> \
        <tr><td>Max. peptide length</td><td><input type=\"number\" min=\"8\" max=\"25\" id=\"max_peptide_length\" /><td></tr> \
        <tr><td>Min. precursor charge</td><td><input type=\"number\" min=\"2\" max=\"6\" id=\"min_precursor_charge\" /><td></tr> \
        <tr><td>Max. precursor charge</td><td><input type=\"number\" min=\"2\" max=\"6\" id=\"max_precursor_charge\" /><td></tr> \
        <tr><td colspan=\"2\">&nbsp;<br>Modifications:</td><td></tr> \
        <tr><td>Oxydation of M</td><td> \
        <input type=\"radio\" id=\"oxy_m_off\" name=\"oxy_m\" /> off \
        <input type=\"radio\" id=\"oxy_m_var\" name=\"oxy_m\" /> variable \
        <input type=\"radio\" id=\"oxy_m_fix\" name=\"oxy_m\" /> fixed \
        <td></tr> \
        <tr><td>Carbamidomethylation of C</td><td> \
        <input type=\"radio\" id=\"carba_c_off\" name=\"carba_c\" /> off \
        <input type=\"radio\" id=\"carba_c_var\" name=\"carba_c\" /> variable \
        <input type=\"radio\" id=\"carba_c_fix\" name=\"carba_c\" /> fixed \
        <td></tr> \
        <tr><td colspan=\"2\">&nbsp;<br><font size=\"1\" color=\"blue\" style=\"cursor: pointer;\" onclick=\" \
        document.getElementById('min_peptide_length').value = 8; \
        document.getElementById('max_peptide_length').value = 25; \
        document.getElementById('min_precursor_charge').value = 2; \
        document.getElementById('max_precursor_charge').value = 3; \
        document.getElementById('oxy_m_off').checked = true; \
        document.getElementById('carba_c_off').checked = true; \
        ;\">default settings</td></tr> \
    </table> \
</div>";


function activateTree(oList) {
    // Collapse the tree
    for (var i = 0; i < oList.getElementsByTagName("ul").length; ++i) {
        oList.getElementsByTagName("ul")[i].style.display = "none";
    }
    for (var i = 0; i < oList.getElementsByTagName("li").length; ++i) {
        if (oList.getElementsByTagName("li")[i].getElementsByTagName("ul").length > 0){
            oList.getElementsByTagName("li")[i].style.fontWeight = "bold";
            oList.getElementsByTagName("li")[i].className = "collapsed";
        }
        else {
            oList.getElementsByTagName("li")[i].style.fontWeight = "normal";
            oList.getElementsByTagName("li")[i].className = "empty";
        }
    }
    // Add the click-event handler to the list items
    if (oList.addEventListener) {
        oList.addEventListener("click", toggleBranch, false);
    } else if (oList.attachEvent) { // For IE
        oList.attachEvent("onclick", toggleBranch);
    }
}


function toggleBranch(event) {
    var oBranch, cSubBranches;
    if (event.target) {
        oBranch = event.target;
    } else if (event.srcElement) { // For IE
        oBranch = event.srcElement;
    }
    cSubBranches = oBranch.getElementsByTagName("ul");
    if (cSubBranches.length > 0) {
        if (cSubBranches[0].style.display == "block") {
            cSubBranches[0].style.display = "none";
            oBranch.className = "collapsed";
            
        } else {
            cSubBranches[0].style.display = "block";
            oBranch.className = "expanded";
        }
    }
    else {
        if (oBranch.style.backgroundColor == ""){
            oBranch.style.backgroundColor = "#4a79ba";
            oBranch.style.color = "#ffffff";
        }
        else {
            oBranch.style.backgroundColor = "";
            oBranch.style.color = "#000000";
        }
    }
}

// get loci
var xmlhttploci = new XMLHttpRequest();
xmlhttploci.onreadystatechange = function() {
    if (xmlhttploci.readyState == 4 && xmlhttploci.status == 200) {
        var locus_data = JSON.parse(xmlhttploci.responseText);
        var locus_select = document.getElementById("loci");
        for (var i = 0; i < locus_data.length; ++i){
            var option = document.createElement("option");
            option.text = locus_data[i][1];
            option.id = locus_data[i][0];
            locus_select.add(option);
        }
    }
}
xmlhttploci.open("GET", "/qsdb/cgi-bin/get-loci.py", true);
xmlhttploci.send();


function recursive_list_adding(function_tree){
    var ret_text = "";
    for (var i = 0; i < function_tree.length; ++i){
        if (function_tree[i][3].length > 0 || function_tree[i][2] > 0){
            ret_text += "<li id=\"" + function_tree[i][0] + "\">" + function_tree[i][1];
            if (function_tree[i][3].length > 0) ret_text += "<ul>" + recursive_list_adding(function_tree[i][3]) + "</ul>";
            else ret_text += " (" + function_tree[i][2] + ")";
            ret_text += "</li>";
        }
    }
    return ret_text;
}


// get functions
var xmlhttpfunctions = new XMLHttpRequest();
xmlhttpfunctions.onreadystatechange = function() {
    if (xmlhttpfunctions.readyState == 4 && xmlhttpfunctions.status == 200) {
        var function_data = JSON.parse(xmlhttpfunctions.responseText);
        var id_dict = {};
        var function_tree = [];
        
        for (var i = 0; i < function_data.length; ++i){
            var function_row = function_data[i];
            if (function_row[2] == 0){
                function_tree = [function_row[0], function_row[1], function_row[3], []];
                id_dict[function_row[0]] = function_tree;
                continue;
            }
            if (function_row[2] in id_dict){
                var node = [function_row[0], function_row[1], function_row[3], []];
                id_dict[function_row[2]][3].push(node);
                id_dict[function_row[0]] = node;
            }
            else {
                console.log("Error while loading functions, index " + function_row[2] + " is missing!");
                return;
            }
        }
        
        var functions_tree_content = "<ul id=\"LinkedList1\" class=\"LinkedList\" style=\"padding-left:0;\">";
        functions_tree_content += recursive_list_adding(function_tree[3]);
        functions_tree_content += "</ul>";
        document.getElementById("function_search_field").innerHTML = functions_tree_content;
        activateTree(document.getElementById("LinkedList1"));
    }
}
xmlhttpfunctions.open("GET", "/qsdb/cgi-bin/get-functions.py", true);
xmlhttpfunctions.send();



function advanced_search_init(){
    window.addEventListener('resize', resize_ms_view, false);
    document.getElementById("msarea").addEventListener("mousewheel", view_mouse_wheel_listener, false);
    document.getElementById("msarea").addEventListener('DOMMouseScroll', view_mouse_wheel_listener, false);
}


function key_down(event){
    // easter egg
    var k_code = [75, 78, 73, 71, 72, 84, 82, 73, 68, 69, 82];
    
    
    //console.log(document.getElementById("how_to_nav").style);
    
    kr_keys.push(event.which);
    while (kr_keys.length > 11) kr_keys.shift();
    if (kr_keys.length == 11){
        var k_is_valid = true;
        for (var i = 0; i < 11; ++i){
            if (k_code[i] != kr_keys[i]){
                k_is_valid = false;
                break;
            }
        }
        if (k_is_valid){
            scanner_data = [1, 0, 0];
            
            var scanner_light = setInterval(function(scanner_data, nav_ids){
                for (var i = 0; i < nav_ids.length; ++i){
                    document.getElementById(nav_ids[i]).style.backgroundColor = "";
                }
                document.getElementById(nav_ids[scanner_data[1]]).style.backgroundColor = "#a20000";
                
                if (scanner_data[0] == -1 && scanner_data[1] == 0) scanner_data[0] = 1;
                if (scanner_data[0] == 1 && scanner_data[1] == 6) scanner_data[0] = -1;
                scanner_data[1] += scanner_data[0];
                
                if (scanner_data[2] % 13 == 0){
                    var audio = document.getElementsByTagName("audio")[0];
                    audio.currentTime = 0;
                    audio.play();
                }
                scanner_data[2] += 1;
                
                if (scanner_data[2] >= 37){
                    for (var i = 0; i < nav_ids.length; ++i){
                        document.getElementById(nav_ids[i]).style.backgroundColor = "";
                    }
                    clearInterval(scanner_light);
                }
            }, 80, scanner_data, nav_ids);
        }
    }    
}

var kr_keys = [];
var back_function = 0;
var scanner_data = [1, 0, 0]; // scanner_up, scanner_index, scanner_count
var nav_ids = ["how_to_nav", "pathway_browser_nav", "subcellular_search_nav", "functional_search_nav", "accession_search_nav", "statistics_nav", "about_nav"];
document.addEventListener('keydown', key_down, false);
document.getElementById("disclaimer_background").addEventListener("click", hide_disclaimer, false);
</script>
</html> 
